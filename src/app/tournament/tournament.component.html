<p-dialog [(visible)]="orgaDialogVisibility"
          [contentStyle]="{'overflow':'visible', 'height':'100%'}"
          [modal]=true
          [width]="400"
          [height]="180">
  <p-header>
    Organizer password required
  </p-header>
  <div class="ui-grid ui-grid-responsive ui-grid-pad ui-fluid">
    <div class="ui-grid-row">
      <div class="ui-grid-col-4">
        Password:
      </div>
      <div class="ui-grid-col-8">
        <input tabindex="1" type="password" pPassword [(ngModel)]="orgaPassword"/>
      </div>
    </div>
    <div class="ui-grid-row"
         *ngIf="passwordWrong">
      <div class="ui-grid-col-12">
        <div class="ui-message ui-messages-error ui-corner-all">
          Password wrong
        </div>
      </div>
    </div>
    <div class="ui-grid-row bottom-button">
      <div class="ui-grid-col-12">
        <button tabindex="2" pButton class="full-width" label="Orga access"
                (click)="checkIfPasswordCorrect()">
        </button>
      </div>
    </div>
  </div>
</p-dialog>

<ng-container *ngIf="(!tournamentLoaded)">
  <div class="heading">Load Tournament...</div>
  <div class="centered-content-container">
    <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
  </div>
</ng-container>

<ng-container *ngIf="(tournamentLoaded)">
  <p-panel [style]="{'text-align':'center'}" header="{{tournament?.name}} - {{tournament?.type}} Tournament"
           [toggleable]="true">
    <div class="sub-heading">ActualRound {{tournament?.actualRound}}</div>
    <div *ngIf="isOrga" class="sub-heading">Hello Organizer</div>

    <div class="centered-content-container">
      <button pButton label="Last Round" (click)="showLastRound()" class="ui-button-info"></button>
      <button *ngIf="!isOrga" pButton label="Orga View" (click)="showOrgaDialog()" class="ui-button-success"></button>
      <button pButton label="Next Round" (click)="showNextRound()" class="ui-button-info"></button>
    </div>
  </p-panel>

  <p-panel *ngIf="isOrga" header="Orga Area" [toggleable]="true">
    <div class="orga-panel-container" *ngIf="tournament?.actualRound === 0">

      <p-autoComplete [(ngModel)]="playerToAdd"
                      [suggestions]="possiblePlayersToAdd"
                      (completeMethod)="filteredParticipants($event)"
                      field="name"
                      [size]="30"
                      placeholder="Search for potential participant"
                      forceSelection="true"
                      class="action-element"
                      [minLength]="1">
      </p-autoComplete>
      <button pButton type="button"
              [disabled]="!playerToAdd"
              class="action-elemen ui-button-success"
              (click)="addParticipant()"
              label="Add Participant">
      </button>
    </div>
    <div class="orga-panel-container" *ngIf="false">
      <button pButton type="button"
              class="action-element"
              (click)="deleteAllParticipants()"
              label="Delete ALL Participant">
      </button>
      <button pButton type="button"
              class="action-element"
              (click)="add20ParticipantsBatch()"
              label="ADD 20">
      </button>
      <button pButton type="button"
              class="action-element"
              (click)="deleteAndAddParticipants()"
              label="DELETE ALL & ADD 20">
      </button>
    </div>
    <div class="orga-panel-container">
      <button *ngIf="tournament?.actualRound === 0"
              pButton type="button"
              class="action-element ui-button-success"
              (click)="createFirstRound()"
              label="Start Tournament"></button>
      <button *ngIf="tournament?.actualRound > 0"
              pButton type="button"
              class="action-element ui-button-success"

              label="New Round"></button>
      <button *ngIf="tournament?.actualRound > 0"
              pButton type="button"
              (click)="deleteRound()"
              class="action-element ui-button-warning"
              label="Delete Round"></button>
    </div>
  </p-panel>
  <p-panel header="Players" [toggleable]="true" [collapsed]="shownRound !== 0">

    <ng-container *ngIf="(!participantsLoaded)">
      <div class="heading">Load Players...</div>
      <div class="centered-content-container">
        <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
      </div>
    </ng-container>

    <p-dataTable *ngIf="(participantsLoaded)"
                 [value]="participants"
                 [editable]="isOrga"
                 [responsive]="true"
                 [rows]="10"
                 [paginator]="true"
                 [pageLinks]="3"
                 [rowsPerPageOptions]="[5,10,20]">
      <p-header>{{participants?.length}} Players</p-header>

      <p-column [editable]="isOrga && tournament?.actualRound === 0"
                styleClass="{{isOrga ? 'editable-column' : ''}}"
                field="name"
                header="Name"
                [sortable]="true"
                [filter]="true"
                filterPlaceholder="Search">
      </p-column>
      <p-column [editable]="isOrga && tournament?.actualRound === 0"
                styleClass="{{isOrga ? 'editable-column' : ''}}"
                field="location"
                header="Location"
                [sortable]="true"
                [filter]="true"
                filterPlaceholder="Search">
      </p-column>

      <ng-container *ngFor="let participantField of gameSystemConfig.participantFields">
        <p-column [editable]="isOrga && tournament?.actualRound === 0"
                  styleClass="{{isOrga ? 'editable-column' : ''}}"
                  field="{{participantField.field}}"
                  header="{{participantField.field}}"
                  [sortable]="true"
                  [filter]="true"
                  filterPlaceholder="Search">
          <ng-template let-col let-participant="rowData" pTemplate="editor">
            <p-dropdown *ngIf="participantField.type === 'dropDown'"
                        [(ngModel)]="participant[col.field]"
                        [options]="participantField.fieldValues"
                        (onChange)="changeParticipant(participant)"
                        [autoWidth]="false"
                        [style]="{'width':'100%'}">
            </p-dropdown>
            <p-multiSelect *ngIf="participantField.type === 'multiSelect'"
                           [(ngModel)]="participant[col.field]"
                           [options]="participantField.fieldValues"
                           (onChange)="changeParticipant(participant)"
                           [showToggleAll]=false
                           [style]="{'width':'100%'}">
            </p-multiSelect>
          </ng-template>
        </p-column>
      </ng-container>
      <p-column>
        <ng-template pTemplate="header">
          Score
        </ng-template>
        <ng-template let-participant="rowData" pTemplate="body">
          {{getScore(participant)}} <i class="fa fa-info-circle" pTooltip="{{getScoreTooltip(participant)}}"></i>
        </ng-template>
      </p-column>

      <ng-container *ngFor="let scoreField of gameSystemConfig.standingFields">
        <p-column>
          <ng-template pTemplate="header">
            {{scoreField.field}}
          </ng-template>
          <ng-template let-participant="rowData" pTemplate="body">
            {{getScoreFieldValue(scoreField, participant)}}
          </ng-template>
        </p-column>
      </ng-container>

      <p-column>
        <ng-template pTemplate="header">
          Actions
        </ng-template>
        <ng-template let-participant="rowData" pTemplate="body">
          <button *ngIf="isOrga && tournament?.actualRound === 0"
                  type="button" pButton (click)="deleteParticipant(participant)" icon="fa-trash" label="Delete">
          </button>
        </ng-template>
      </p-column>
    </p-dataTable>
  </p-panel>
  <p-panel *ngIf="shownRound > 0" header="Pairings Round {{shownRound}}" [toggleable]="true">

    <ng-container *ngIf="(!roundLoaded)">
      <div class="heading">Load Round...</div>
      <div class="centered-content-container">
        <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
      </div>
    </ng-container>

    <p-dataTable *ngIf="(roundLoaded)"
                 [value]="roundMatches"
                 [editable]="isOrga"
                 [responsive]="true"
                 [rowStyleClass]="getStyleForMatchesRow"
                 [rows]="10"
                 [paginator]="true"
                 [pageLinks]="3"
                 [rowsPerPageOptions]="[5,10,20]">
      <p-header>{{roundMatches?.length}} Matches</p-header>
      <p-column styleClass="col-result" *ngIf="isOrga">
        <ng-template pTemplate="header">Result</ng-template>
        <ng-template pTemplate="body" let-roundMatch="rowData">
          <p-dropdown placeholder="Not Finished"
                      [(ngModel)]="roundMatch['result']"
                      [options]="winningOptions"
                      (onChange)="changeWinner($event, roundMatch)">
          </p-dropdown>
        </ng-template>
      </p-column>
      <p-column styleClass="col-player col-firstPlayer"
                [sortable]="true"
                [filter]="true"
                filterPlaceholder="Search">
        <ng-template pTemplate="header">Player 1</ng-template>
        <ng-template pTemplate="body" let-roundMatch="rowData">
          <span [ngClass]="{
                   'winner-label': (roundMatch.scoreParticipantOne === 1 && roundMatch.finished),
                   'looser-label': (roundMatch.scoreParticipantTwo === 1 && roundMatch.finished),
                   'draw-label': (roundMatch.scoreParticipantOne === roundMatch.scoreParticipantTwo && roundMatch.finished)
                }">
                {{roundMatch.participantOne.name}}
                ({{roundMatch.participantOne.roundScores[shownRound - 1] ? roundMatch.participantOne.roundScores[shownRound - 1] : '0'}})
          </span>
        </ng-template>
      </p-column>
      <p-column styleClass="col-vs">
        <ng-template pTemplate="header"></ng-template>
        <ng-template pTemplate="body">
          <span>VS</span>
        </ng-template>
      </p-column>
      <p-column styleClass="col-player"
                [sortable]="true"
                [filter]="true"
                filterPlaceholder="Search">
        <ng-template pTemplate="header">Player 2</ng-template>
        <ng-template pTemplate="body" let-roundMatch="rowData">
          <span [ngClass]="{
                   'winner-label': (roundMatch.scoreParticipantTwo === 1 && roundMatch.finished),
                   'looser-label': (roundMatch.scoreParticipantOne === 1 && roundMatch.finished),
                   'draw-label': (roundMatch.scoreParticipantOne === roundMatch.scoreParticipantTwo && roundMatch.finished)
                }">
                {{roundMatch.participantTwo.name}}
                ({{roundMatch.participantTwo.roundScores[shownRound - 1] ? roundMatch.participantTwo.roundScores[shownRound - 1] : '0'}})
          </span>
        </ng-template>
      </p-column>

      <ng-container *ngFor="let scoreField of gameSystemConfig.scoreFields">
        <p-column *ngIf="isOrga" styleClass="col-scoring">
          <ng-template pTemplate="header">
            {{scoreField.field}}
          </ng-template>
          <ng-template let-col let-roundMatch="rowData" pTemplate="body">
            P1<p-spinner size="5" [(ngModel)]="roundMatch[scoreField.fieldPlayerOne]" [min]="scoreField.min" [max]="scoreField.max">

            </p-spinner>
            P2<p-spinner size="5" [(ngModel)]="roundMatch[scoreField.fieldPlayerTwo]"
                       [min]="scoreField.min" [max]="scoreField.max"
                       (onBlur)="changeScoringPlayerTwo(roundMatch, scoreField.field, roundMatch[scoreField.fieldPlayerTwo])">
            </p-spinner>
          </ng-template>
        </p-column>
      </ng-container>


    </p-dataTable>
  </p-panel>

</ng-container>


